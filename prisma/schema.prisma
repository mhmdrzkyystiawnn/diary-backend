generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Model User
model User {
  id        Int      @id @default(autoincrement())
  username  String
  email     String   @unique
  password  String?  // Boleh kosong kalau login pake Google
  avatar    String?
  createdAt DateTime @default(now())

  files     File[]

  // Kolom buat reset password
  resetPasswordToken   String?
  resetPasswordExpires DateTime?

  @@map("users") // Nama tabel di database jadi 'users'
}

// Model File
model File {
  id           Int      @id @default(autoincrement())
  originalName String
  filename     String
  path         String
  mimeType     String
  size         Int
  createdAt    DateTime @default(now())
  
  // KOLOM BARU YANG DIPERLUKAN CONTROLLER
  fileHash     String?  // Buat cek duplikat
  type         String?  // PHOTO, AUDIO, dll
  metadata     Json?    // Buat nyimpen data tambahan (flexibel)

  userId       Int
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  memory       Memory?
  notes        TimestampNote[]

  @@map("files")
}

// Model Memory (Diary)
model Memory {
  id        Int      @id @default(autoincrement())
  content   String   @db.Text
  mood      String?
  createdAt DateTime @default(now())
  
  fileId    Int      @unique
  file      File     @relation(fields: [fileId], references: [id], onDelete: Cascade)

  @@map("memories")
}

// Model TimestampNote (Komentar per detik audio)
model TimestampNote {
  id        Int      @id @default(autoincrement())
  timestamp Int      // Detik ke berapa
  content   String
  createdAt DateTime @default(now())

  fileId    Int
  file      File     @relation(fields: [fileId], references: [id], onDelete: Cascade)

  @@map("timestamp_notes")
}
